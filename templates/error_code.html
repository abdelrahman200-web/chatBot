{% extends 'nav_bar.html' %}
{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø±Ù…ÙˆØ² Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ | WhatsApp Bot{% endblock %}
{% block content %}
<link rel="stylesheet" href="../static/main.css">
<div class="container">
    <h2>âš ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø±Ù…ÙˆØ² Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</h2>  
    
    <h3>â• Ø¥Ø¶Ø§ÙØ© Ø±Ù…Ø² Ø®Ø·Ø£ Ø¬Ø¯ÙŠØ¯</h3>
    <form action="/add_error_code" method="POST">
        <input type="text" name="code" placeholder="Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£" required maxlength="20">
        <input type="text" name="action_ar" placeholder="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" required maxlength="50">
        <input type="text" name="action_en" placeholder="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©" required maxlength="50">
        <button type="submit">Ø¥Ø¶Ø§ÙØ©</button>
    </form>
    
    <h3>ğŸ“œ Ù‚Ø§Ø¦Ù…Ø© Ø±Ù…ÙˆØ² Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</h3>
    <table>
        <thead>
            <tr>
                <th>Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ (Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©)</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
        </thead>
        <tbody>
            {% for error in error_codes %}
            <tr id="row-{{ error.code }}">
                <td>{{ error.code }}</td>
                <td>{{ error.action_ar }}</td>
                <td>{{ error.action_en }}</td>
                <td>
                    <button class="delete-btn" data-code="{{ error.code }}" onclick="deleteErrorCode(this)">âŒ Ø­Ø°Ù</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
{% block script %}
<script>
    function deleteErrorCode(button) {
        let errorCode = button.getAttribute("data-code");
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£ØŸ")) {
            fetch(`/delete_error_code/${errorCode}`, { method: "DELETE" })
            .then(response => response.json())
            .then(data => {
                if (data.message.includes("ØªÙ… Ø­Ø°Ù Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£")) {
                    let row = document.getElementById(`row-${errorCode}`);
                    if (row) {
                        row.remove();
                    }
                    alert("âœ… ØªÙ… Ø­Ø°Ù Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£ Ø¨Ù†Ø¬Ø§Ø­!");
                } else {
                    alert("âŒ ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                }
            })
            .catch(error => console.error("âŒ Ø®Ø·Ø£:", error));
        }
    }
</script>
{% endblock %}